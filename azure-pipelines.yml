# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript
trigger:
  - dev
pool:
  vmImage: ubuntu-latest
steps:
  - task: UseNode@1
    inputs:
      version: ">=21.x"
    displayName: "Install Node.js"
- task: Npm@1
  displayName: "Install Bun.js"
  inputs:
    command: 'custom'
    customCommand: 'install -g bun'
    verbose: true
- bash:
    bun install
  displayName: "Install deps"
- bash:
    bun run build
  displayName: "Build the app"
- task: CopyFiles@2
  inputs:
    SourceFolder: ".next"
    Contents: "**"
    TargetFolder: "$(build.artifactstagingdirectory)"
    CleanTargetFolder: true
  displayName: "Copy build output to artifact staging directory"
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: "$(Build.ArtifactStagingDirectory)"
    ArtifactName: "build_$(Build.SourceBranchName)_$(Build.SourceVersion)"
    publishLocation: "Container"
    StoreAsTar: true
